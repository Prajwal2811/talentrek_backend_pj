CREATE TABLE talentrek_jobseeker_training_material_purchases_payment_request (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    jobseeker_id BIGINT UNSIGNED NOT NULL,
    trainer_id BIGINT UNSIGNED NOT NULL,
    material_id BIGINT UNSIGNED NOT NULL,
    batch_id BIGINT UNSIGNED NULL,
    request_payload JSON NULL,
    track_id VARCHAR(100) NOT NULL UNIQUE, -- unique track/reference ID
    type ENUM('buyNow', 'buyForCorporate', 'cart') NOT NULL,
    training_type VARCHAR(50) NOT NULL, -- e.g., online/classroom/recorded
    transaction_id VARCHAR(100) NULL,
    payment_status ENUM('initiated', 'success', 'failed', 'refunded') DEFAULT 'initiated',
    tax DECIMAL(10,2) NOT NULL DEFAULT 0.00,
    amount DECIMAL(10,2) NOT NULL DEFAULT 0.00,        -- base amount
    amount_paid DECIMAL(10,2) NOT NULL DEFAULT 0.00,   -- actual paid after discount/tax
    currency VARCHAR(10) NOT NULL DEFAULT 'INR',
    payment_gateway VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_jobseeker (jobseeker_id),
    INDEX idx_trainer (trainer_id),
    INDEX idx_material (material_id),
    INDEX idx_batch (batch_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

ALTER TABLE `talentrek_jobseeker_training_material_purchases`
ADD COLUMN `track_id` varchar(100) DEFAULT NULL AFTER `transaction_id`,
ADD COLUMN `payment_status` enum('pending','success','failed','refunded') NOT NULL DEFAULT 'pending' AFTER `transaction_id`,
ADD COLUMN `response_payload` json DEFAULT NULL AFTER `payment_status`,
ADD COLUMN `amount` DECIMAL(10,2) NOT NULL DEFAULT 0.00 AFTER `response_payload`,
ADD COLUMN `tax` DECIMAL(10,2) NOT NULL DEFAULT 0.00 AFTER `amount`,
ADD COLUMN `total_amount` DECIMAL(10,2) NOT NULL DEFAULT 0.00 AFTER `tax`;



ALTER TABLE `talentrek_jobseeker_training_material_purchases`
ADD COLUMN `coupon_type` VARCHAR(50) NULL AFTER `total_amount`,
ADD COLUMN `coupon_code` VARCHAR(100) NULL AFTER `coupon_type`,
ADD COLUMN `coupon_amount` DECIMAL(10,2) NOT NULL DEFAULT 0.00 AFTER `coupon_code`,
ADD COLUMN `order_id` VARCHAR(100) NULL AFTER `coupon_amount`;


